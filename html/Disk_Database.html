<TITLE>coldmud.info: Disk Database</TITLE>
Next: <A HREF="Connections.html">Connections</A><P>
Prev: <A HREF="Starting.html">Starting</A><P>

<H2>Disk Database</H2>

Coldmud normally operates using a binary disk-based database, storing
only a small number of objects in memory at any given time.  This number
is usually no more than the product of the cache width and the cache
depth (fixed at 7 and 23 in this version).<P>
<P>
Coldmud's database is normally stored in binary format in the file
<SAMP>binary/objects</SAMP> (relative to the database directory) and in an
ndbm database with the prefix <SAMP>binary/index</SAMP>.  The file
<SAMP>binary/clean</SAMP> exists when the database is consistent.  The
functions <CODE>binary_dump()</CODE> and <CODE>shutdown()</CODE> force binary
database consistency.<P>
<P>
Because ndbm databases are usually byte-order-dependent, a binary
database generated by a Coldmud process on one machine cannot be
guaranteed to work with a process on another machine.  Binary databases
are also heavily version-dependent; small changes in the internal format
of an object in a new version of the server will invalidate old binary
databases, even if the <CODE>C--</CODE> language and the conceptual structure
of a Coldmud object remain the same in the new version.<P>
<P>
Coldmud also supports a text format for databases.  The
<CODE>text_dump()</CODE> function stores a text database dump in the file
<SAMP>textdump</SAMP>.  Text dumps specify the database in terms of the
<CODE>C--</CODE> language and a few simple directives, so they are compatible
with any version of Coldmud which can understand the <CODE>C--</CODE> code
contained in it.  Text dumps are also simple enough to be written and
edited by humans, so they provide a good mechanism for distribution of
core databases.<P>
<P>
At startup time, Coldmud looks for the file <SAMP>binary/clean</SAMP> to
determine if a consistent binary database exists and was generated by
the same version of Coldmud as the running process.  If a clean binary
database exists, Coldmud will start up very quickly, pausing only to
read in the root object and system object.  Otherwise, Coldmud tries to
read in a text dump from the file <SAMP>textdump</SAMP>.  You can force the
use of a text dump by simple removing the file <SAMP>binary/clean</SAMP>.
Coldmud will fail to start if it cannot find a consistent binary
database or a text dump.<P>
<P>
